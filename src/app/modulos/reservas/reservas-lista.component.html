<div class="reservas-page bocket-animate-in">
  <div class="page-header professional-header">
    <div class="header-content">
      <div class="header-info">
        <h1 class="page-title-enhanced">
          <ion-icon name="calendar-outline" class="title-icon"></ion-icon>
          Gestión de Reservas
        </h1>
        <p class="page-subtitle-enhanced">Administra y monitorea todas las reservas en tiempo real</p>
      </div>
      <div class="header-actions">
        <ion-button fill="clear" (click)="actualizarLista()" [disabled]="cargando" class="refresh-btn-reservas">
          <ion-icon name="refresh-outline" [class.spinning-icon]="cargando"></ion-icon>
          <span *ngIf="!cargando">Actualizar</span>
          <span *ngIf="cargando">Actualizando...</span>
        </ion-button>
        <ion-button color="primary" (click)="nuevaReserva()" class="new-reservation-btn">
          <ion-icon name="add-circle-outline" slot="start"></ion-icon>
          Nueva Reserva
        </ion-button>
      </div>
    </div>
  </div>
  
  <!-- Estadísticas Mejoradas -->
  <div class="stats-grid-enhanced">
    <div class="stat-card-enhanced total-reservations" (click)="filtrarPorEstado('')">
      <div class="stat-icon-container">
        <ion-icon name="calendar" class="stat-icon"></ion-icon>
        <div class="stat-pulse"></div>
      </div>
      <div class="stat-content">
        <div class="stat-value-enhanced">{{ estadisticas.total }}</div>
        <div class="stat-label-enhanced">Total Reservas</div>
        <div class="stat-trend">
          <ion-icon name="trending-up" class="trend-icon"></ion-icon>
          <span class="trend-text">+8% vs ayer</span>
        </div>
      </div>
    </div>
    
    <div class="stat-card-enhanced pending-reservations" (click)="filtrarPorEstado('pending')">
      <div class="stat-icon-container">
        <ion-icon name="time" class="stat-icon"></ion-icon>
        <div class="stat-pulse warning"></div>
      </div>
      <div class="stat-content">
        <div class="stat-value-enhanced">{{ estadisticas.pendientes }}</div>
        <div class="stat-label-enhanced">Pendientes</div>
        <div class="stat-trend warning" *ngIf="estadisticas.pendientes > 0">
          <ion-icon name="alert-circle" class="trend-icon"></ion-icon>
          <span class="trend-text">Requiere confirmación</span>
        </div>
      </div>
    </div>
    
    <div class="stat-card-enhanced confirmed-reservations" (click)="filtrarPorEstado('accepted')">
      <div class="stat-icon-container">
        <ion-icon name="checkmark-circle" class="stat-icon"></ion-icon>
        <div class="stat-pulse success"></div>
      </div>
      <div class="stat-content">
        <div class="stat-value-enhanced">{{ estadisticas.confirmadas }}</div>
        <div class="stat-label-enhanced">Confirmadas</div>
        <div class="stat-trend success">
          <ion-icon name="checkmark" class="trend-icon"></ion-icon>
          <span class="trend-text">Activas</span>
        </div>
      </div>
    </div>
    
    <div class="stat-card-enhanced today-reservations" (click)="filtrarPorFecha('hoy')">
      <div class="stat-icon-container">
        <ion-icon name="today" class="stat-icon"></ion-icon>
        <div class="stat-pulse delivery"></div>
      </div>
      <div class="stat-content">
        <div class="stat-value-enhanced">{{ estadisticas.hoy }}</div>
        <div class="stat-label-enhanced">Para Hoy</div>
        <div class="stat-trend delivery">
          <ion-icon name="alarm" class="trend-icon"></ion-icon>
          <span class="trend-text">Próximas</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros y búsqueda -->
  <div class="filtros-section">
    <div class="filtros-row">
      <ion-searchbar 
        placeholder="Buscar reservas..."
        [value]="terminoBusqueda"
        (ionInput)="buscarReservas($event)"
        class="search-bar">
      </ion-searchbar>
      
      <ion-select 
        [value]="filtroEstado"
        (ionChange)="filtrarPorEstadoSelect($event)"
        placeholder="Estado"
        class="filter-select">
        <ion-select-option *ngFor="let estado of estadosDisponibles" [value]="estado.value">
          {{ estado.label }}
        </ion-select-option>
      </ion-select>
      
      <ion-select 
        [value]="filtroFecha"
        (ionChange)="filtrarPorFecha($event)"
        placeholder="Filtrar por fecha"
        class="filter-select">
        <ion-select-option *ngFor="let periodo of periodosDisponibles" [value]="periodo.value">
          {{ periodo.label }}
        </ion-select-option>
      </ion-select>
    </div>
    
    <!-- Filtros de fecha -->
    <div class="filtros-fecha-row" *ngIf="filtroFecha === 'custom'">
      <div class="fecha-custom">
        <ion-datetime
          [value]="fechaDesde"
          (ionChange)="cambiarFechaDesde($event)"
          placeholder="Desde"
          display-format="DD/MM/YYYY"
          picker-format="DD MMM YYYY"
          class="fecha-input">
        </ion-datetime>
        
        <ion-datetime
          [value]="fechaHasta"
          (ionChange)="cambiarFechaHasta($event)"
          placeholder="Hasta"
          display-format="DD/MM/YYYY"
          picker-format="DD MMM YYYY"
          class="fecha-input">
        </ion-datetime>
      </div>
    </div>
  </div>

  <!-- Lista de Reservas -->
  <div class="reservas-content">
    <!-- Loading -->
    <div *ngIf="cargando" class="loading-state">
      <ion-spinner></ion-spinner>
      <p>Cargando reservas...</p>
    </div>

    <!-- Error -->
    <div *ngIf="error && !cargando" class="error-state">
      <ion-icon name="alert-circle-outline"></ion-icon>
      <p>{{ error }}</p>
      <ion-button fill="outline" (click)="cargarReservas()">
        Reintentar
      </ion-button>
    </div>

    <!-- Lista vacía -->
    <div *ngIf="!cargando && !error && reservasFiltradas.length === 0" class="empty-state">
      <ion-icon name="calendar-outline"></ion-icon>
      <h3>No hay reservas</h3>
      <p>No se encontraron reservas con los filtros aplicados</p>
      <ion-button color="primary" (click)="nuevaReserva()">
        Crear Primera Reserva
      </ion-button>
    </div>

    <!-- Lista de reservas -->
    <div *ngIf="!cargando && !error && reservasFiltradas.length > 0" class="reservas-list">
      <div *ngFor="let reserva of reservasFiltradas" class="reserva-card" (click)="verDetalleReserva(reserva)">
        
        <div class="reserva-header">
          <div class="reserva-info">
            <h3>{{ reserva.contactNameBooking }}</h3>
            <p class="reserva-contact">{{ reserva.contact }} - {{ reserva.finalPeopleBooking }} personas</p>
          </div>
          <div class="reserva-badges">
            <span class="badge-estado" [ngClass]="obtenerClaseEstado(reserva.statusBooking)">
              {{ obtenerEstadoLabel(reserva.statusBooking) }}
            </span>
          </div>
        </div>

        <div class="reserva-body">
          <div class="reserva-resumen">
            <p *ngIf="reserva.detailsBooking"><strong>Detalles:</strong> {{ reserva.detailsBooking }}</p>
          </div>
          <div class="reserva-fecha-info">
            <div class="fecha-item">
              <ion-icon name="calendar-outline" class="fecha-icon"></ion-icon>
              <span class="fecha-label">Fecha:</span>
              <span class="fecha-valor">{{ formatearFechaHora(reserva.dateBooking) }}</span>
            </div>
            <div class="fecha-item" *ngIf="reserva.reconfirmDate">
              <ion-icon name="checkmark-circle-outline" class="fecha-icon"></ion-icon>
              <span class="fecha-label">Reconfirmado:</span>
              <span class="fecha-valor">{{ formatearFechaHora(reserva.reconfirmDate) }}</span>
            </div>
            <div class="fecha-item tiempo-transcurrido">
              <ion-icon name="time-outline" class="fecha-icon"></ion-icon>
              <span class="fecha-label">Para:</span>
              <span class="fecha-valor">{{ calcularTiempoHastaReserva(reserva.dateBooking) }}</span>
            </div>
          </div>
        </div>

        <div class="reserva-actions" (click)="$event.stopPropagation()">
          <!-- Acciones según estado -->
          <ion-button 
            *ngIf="reserva.statusBooking === 'pending'" 
            fill="clear" 
            color="success" 
            size="small"
            (click)="confirmarReserva(reserva, $event)">
            <ion-icon name="checkmark" slot="icon-only"></ion-icon>
          </ion-button>
          
          <ion-button 
            *ngIf="reserva.statusBooking === 'pending'" 
            fill="clear" 
            color="danger" 
            size="small"
            (click)="cancelarReserva(reserva, $event)">
            <ion-icon name="close" slot="icon-only"></ion-icon>
          </ion-button>
          
          <ion-button 
            fill="clear" 
            color="medium" 
            size="small"
            (click)="editarReserva(reserva, $event)">
            <ion-icon name="create" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>
  </div>

</div>